<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ASRS-O – Observer Version</title>

<!-- EmailJS v4 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script type="text/javascript">
  emailjs.init('tLhmSfXReaAYqCkT9');
</script>

<!-- jsPDF -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
body { font-family: Arial, Helvetica, sans-serif; margin: 40px; background: #fafafa; color: #222; }
h1 { font-size: 22px; }
p { font-size: 14px; line-height: 1.5; }

.info { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 10px; margin-bottom: 20px; }
.info input { width: 100%; padding: 10px; font-size: 15px; }

.question { background: #fff; border: 1px solid #ddd; padding: 15px; margin-bottom: 12px; border-radius: 6px; }
.question-title { font-size: 15px; margin-bottom: 8px; }
.scale { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px; }
.scale label { display: flex; align-items: center; gap: 6px; padding: 8px 12px; border: 1px solid #ccc; border-radius: 20px; background: #f7f7f7; cursor: pointer; }
.scale input { transform: scale(1.2); }

textarea { width: 100%; min-height: 80px; resize: vertical; padding: 8px; font-size: 15px; }

#actionButtons { display:flex; gap:10px; margin:30px 0; }
#actionButtons button { flex:1; padding:16px; font-size:17px; border-radius:32px; cursor:pointer; }

.footer { margin-top: 30px; font-size: 12px; color: #555; }

@media (max-width: 450px) { body { margin: 12px; } h1 { font-size: 18px; } p { font-size: 15px; } }
@media print { #actionButtons { display: none; } .question { page-break-inside: avoid; } }
</style>
</head>

<body>

<h1>Adult ADHD Self-Report Scale – Observer Version (ASRS-O)</h1>

<p><strong>Instructions:</strong> Please answer the questions below based on your observations over the past <strong>6 months</strong>.</p>

<!-- Observer and person info -->
<div class="info">
  <input type="text" name="date" placeholder="Date">
  <input type="text" name="person_name" placeholder="Name of person being evaluated">
  <input type="text" name="dob" placeholder="Date of birth">
  <input type="text" name="observer_name" placeholder="Observer's name">
  <input type="text" name="observer_phone" placeholder="Observer's phone">
  <input type="email" name="observer_email" placeholder="Observer's email">
</div>

<div id="questions"></div>

<!-- Buttons -->
<div id="actionButtons">
  <button id="pdfBtn">Download PDF</button>
  <button id="sendBtn">Send Results</button>
</div>

<div class="footer">
  <p><strong>Additional relevant information:</strong></p>
  <textarea id="extraInfo" placeholder="Please provide any additional information relevant to the above situations..."></textarea>
  <p style="margin-top:10px;">© World Health Organization, 2005 – Unofficial translation for clinical purposes</p>
</div>

<script>
const questions = [
  "How often does this person have trouble wrapping up the final details of a project, once the challenging parts have been done?",
  "How often does this person have difficulty getting things in order when they have to do a task that requires organization?",
  "How often does this person have problems remembering appointments or obligations?",
  "When this person has a task that requires a lot of thought, how often do they avoid or delay getting started?",
  "How often does this person fidget or squirm with their hands or feet when they have to sit down for a long time?",
  "How often does this person seem overly active and compelled to do things, as if they were driven by a motor?",
  "How often does this person make careless mistakes when they have to work on a boring or difficult project?",
  "How often does this person have difficulty keeping their attention when doing boring or repetitive work?",
  "How often does this person have difficulty concentrating on what people are saying, even when they are speaking to the person directly?",
  "How often does this person misplace or have difficulty finding things at home or at work?",
  "How often is this person distracted by activity or noise around them?",
  "How often does this person leave their seat in meetings or other situations in which they are expected to remain seated?",
  "How often does this person appear restless or fidgety?",
  "How often does this person have difficulty unwinding and relaxing when they have time to themselves?",
  "How often does this person talk too much when in social situations?",
  "When this person is in a conversation, how often do they finish the sentences of the people they are talking to, before they can finish them themselves?",
  "How often does this person have difficulty waiting their turn in situations when turn taking is required?",
  "How often does this person interrupt others?"
];

const labels = ["0 = Never","1 = Rarely","2 = Sometimes","3 = Often","4 = Very Often"];
const container = document.getElementById('questions');

// Generate questions dynamically
questions.forEach((text, i) => {
  const div = document.createElement('div');
  div.className = 'question';
  div.innerHTML = `
    <div class="question-title"><strong>${i+1}.</strong> ${text}</div>
    <div class="scale">
      ${labels.map((l,j)=>`
        <label>
          <input type="radio" name="q${i+1}" value="${j}">${l}
        </label>`).join('')}
    </div>
    <textarea name="details_q${i+1}" placeholder="Examples/details:"></textarea>
  `;
  container.appendChild(div);
});

// Generate PDF and email text
function generatePDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  let y = 10;
  let emailText = "ASRS-O – Observer Version\n\n";

  const infoInputs = document.querySelectorAll('.info input');
  infoInputs.forEach(input => {
    const val = input.value || "Not provided";
    emailText += `${input.placeholder}: ${val}\n`;
  });
  emailText += "\n";

  document.querySelectorAll('.question').forEach((q, i) => {
    const title = q.querySelector('.question-title').innerText;
    const checked = q.querySelector('input[type="radio"]:checked');
    const value = checked ? checked.value : "not answered";
    const details = q.querySelector('textarea').value || "";

    emailText += `${title}\nAnswer: ${value}\n`;
    if(details) emailText += `Details: ${details}\n`;
    emailText += "\n";

    doc.setFontSize(12);
    doc.text(`${i+1}. ${title}`, 10, y); y += 6;
    doc.setFontSize(10);
    doc.text(`Answer: ${value}`, 10, y); y += 6;
    if(details){
      const split = doc.splitTextToSize("Details: " + details, 180);
      doc.text(split, 10, y);
      y += split.length * 6;
    }
    y += 4;
    if(y > 270){ doc.addPage(); y = 10; }
  });

  const extra = document.getElementById('extraInfo').value || "";
  if(extra){
    emailText += "Additional information:\n" + extra;
  }

  return { doc, emailText };
}

// Download PDF
document.getElementById('pdfBtn').addEventListener('click', () => {
  const { doc } = generatePDF();
  const obsName = (document.querySelector('input[name="observer_name"]').value || "Observer").replace(/\s+/g,'_');
  doc.save(`ASRS-O_${obsName}.pdf`);
});

// Send Results
document.getElementById('sendBtn').addEventListener('click', async () => {
  const { emailText } = generatePDF();

  const infoInputs = document.querySelectorAll('.info input');
  const emailData = {};
  infoInputs.forEach(input => {
    emailData[input.name] = input.value || "Not provided";
  });

  const answers = {};
  document.querySelectorAll('.question').forEach((q, i) => {
    const checked = q.querySelector('input[type="radio"]:checked');
    const value = checked ? checked.value : "not answered";
    const details = q.querySelector('textarea').value || "";
    answers[`q${i+1}`] = value;
    answers[`details_q${i+1}`] = details;
  });

  try{
    await emailjs.send('service_198fh21','template_l7n4c9e',{
      from_name: "ASRS-O Web Form",
      to_name: "Enrico Zerbo",
      to_email: "enrico.zerbo@email.com",
      reply_to: emailData.observer_email || 'no-reply@asrs-o.local',
      message: emailText,
      ...emailData,
      ...answers
    });
    alert("Results sent successfully!");
  }catch(err){
    console.error(err);
    alert("Error sending results.");
  }
});
</script>

</body>
</html>
